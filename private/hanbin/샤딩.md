# Sharding과 Master-Slave

- 수직 분할
  - 열 분할
  - hit ratio에 따라 분리도 가능
- 수평 분할(horizonal partitioning)과 샤딩
  - 같은 DB 내에서의 분할(수평 분할)
  - 다른 DB로의 분할(샤딩)
  - 한 스키마의 단일 인스턴스인지, 여러 인스턴스인지의 차이점으로도 볼 수 있음
- 샤딩 키
  - 일반적으로는 PK로 많이 설정
  - 비즈니스에 따라 신중하게 설정
    - 샤드가 데이터의 실제 분할과 유관한 경우 특히 이점을 가짐
    - 예를 들어, 다국적 서비스를 하고 있으며 각 국가별 DB가 존재할 때,
      회원 국적에 따른 샤딩을 수행하는 것은 유용
- 샤딩 방식
  - 알고리즘 샤딩
    - 알고리즘에 따라 샤딩 위치
    - 쿼리 시에 키를 가지고 있어야 한다는 점
  - 모듈러 샤딩(알고리즘 샤딩의 일종)
    - 모듈러 연산(`%`)을 이용
    - 균일한 분할이 강점
    - DB 증설 시 이미 저장된 데이터를 재정렬해야 함
  - 레인지 샤딩
    - 샤딩 키의 범위에 따라 DB 할당
    - 모듈러 샤딩과 달리 재정렬은 필요 없지만,
    - 특정 DB 편중이 발생할 수 있다는 단점
  - 동적 샤딩: 외부 locator를 이용하는 방식
  - 디렉토리 샤딩
- 샤딩 유의사항
  - 하나의 고객이 너무 커질 경우?
  - 하나의 데이터가 샤드 크기보다 커질 경우?
  - 서비스 / 기능별 분할이라는 대안이 있음
  - DB 레벨 트랙잭션 보장이 안 된다는 단점
    - 애플리케이션 레벨의 처리가 필요
- 마스터 - 슬레이브 구조
  - 변경 담당 - 마스터
  - 읽기 담당 - 슬레이브
  - 마스터의 변경 사항을 슬레이브에게 반영
  - MySQL의 동기화 방식
    - 이벤트 로그에 변경 내역이 쌓임
    - 슬레이브에서 이벤트 로그을 읽어서 신규 사항을 반영시킴
