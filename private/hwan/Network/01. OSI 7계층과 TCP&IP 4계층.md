## OSI 7계층 
![](https://i.imgur.com/IsTFFpk.png)
[출처](https://www.inflearn.com/course/%EA%B0%9C%EB%B0%9C%EC%9E%90-%EC%A0%84%EA%B3%B5%EB%A9%B4%EC%A0%91-cs-%EC%99%84%EC%A0%84%EC%A0%95%EB%B3%B5/dashboard)
**네트워크 통신을 표준화한 모델**로, 통신 시스템을 7단계로 나눈 것
각 계층은 하위 계층의 기능을 이용하고, 상위 계층에게 기능을 제공한다. (HTTP는 TCP과 IP을 이용해서 작동)
일반적으로 상위 계층의 프로토콜은 소프트웨어로, 하위 계층의 프로토콜은 하드웨어로 구현된다.(물리 계층의 통신은 케이블을 통한 전기 신호로 이루어짐)


### 왜 나눌까?
통신이 일어나는 과정을 단계별로 알 수 있고, 특정한 곳에 이상이 생기면 그 단계만 수정이 가능하기 때문에


### 1계층 :  물리 계층 (Physical Layer)
- 전기적, 기계적, 기능적인 특성을 이용한 통신 케이블로 데이터를 전송한다. 
- 통신 단위는 비트단위이다. 
- 데이터를 전기적인 아날로그 신호로 변환해서 주고 받는 기능 (비트 -> 전기신호로 인코딩, 전기신호 -> 비트로 디코딩)
- 데이터를 전달만 할 뿐 전송하거나 받으려는 데이터가 무엇이고, 어떤 에러가 있는 지는 신경쓰지 않는다.
- 주요 장비로 통신 케이블, 리피터, 허브 등이 있다.
	- **리피터** : 전기 신호를 정형(일그러진 전기 신호를 복원)하고 증폭하는 기능을 가진 네트워크 중계 장비 (다른 네트워크 장비가 리피터 기능을 지원해서 잘 사용하진 않음)
	- **허브** : 리퍼터기능과 함께 컴퓨터 여러 대를 서로 연결하는 장치 (전기 신호를 전달 받은 포트를 제외한 모든 포트로 보내기 때문에 더미허브라고도 불림.)
	- **트위스트 페어 케이블** : 여덟개의 구리선을 두 개씩 꼬아서 묶은 케이블 
		- UTP : 실드 처리를 하지 않은 케이블 (노이즈 영향 O, 저렴)
		- STP : 실드 처리를 한 케이블 (노이즈 영향 X, 비쌈)
		- 주로 UTP 케이블를 사용하며 이를 LAN 케이블이라고도 한다. 
			- 양쪽 끝에는 RJ-45라고 부르는 커넥터가 있다.

### 2계층 : 데이터 링크 계층 (Data Link Layer)
> 네트워크 기기 간에 데이터를 전송하고 물리 주소를 결정 
> 즉, 같은 네트워크에 있는 여러 대의 컴퓨터들이 데이터를 주고받기 위해서 필요한 모듈
- 물리 계층을 통해 송수신되는 정보의 오류와 흐름을 관리하여 안전한 정보의 전달을 수행할 수 있도록 한다. 
- 통신에서의 오류도 찾아주고, 오류가 있다면 데이터를 재전송하는 기능을 가지고 있다. 
- MAC 주소 체계를 가진다. 
	- MAC : 랜 카드의 물리 주소이며 전 셰계에서 유일한 번호이다.
- 이더넷 헤더와 트레일러를 붙이며 이를 **프레임**이라고 부른다.
	![](https://i.imgur.com/7Xco0n3.jpg)
	- Premable : 이더넷 프레임이 시작임을 알림 
	- SFD : 다음 바이트부터 MAC 주소 필드가 시작됨을 알림 
	- DMAC, SMAC : 수신, 송신 MAC 주소 
	- EtherType : 데이터 계층 위의 계층인 IP 프로토콜을 정의 (IPv4, IPv6 ...)
	- Payload : 전달받은 데이터 
	- CRC : 에러 확인 비트 
- 주요 장비로는 브릿지, 스위치 등이 있다.
	- 스위치 : MAC 주소 테이블이 있다. 
		- MAC 주소 테이블 : 스위치의 포트 번호와 그 포트에 연결되어 있는 컴퓨터의 MAC 주소가 등록되는 데이터베이스 
		- 플러딩 : 스위치가 수신 포트 이외의 모든 포트에서 데이터를 송신하는 것 
		- MAC 주소 필터링 : 스위치에서 MAC주소를 기준으로 목적지를 선택하는 것
	- 과정 
		- 프레임을 전송 시 출발지 MAC 주소가 등록되어 있지 않다면 포트와 함께 등록 
		- 목적지 MAC 주소가 등록되어 있지 않다면 플러딩 발생 
		- 등록되어 있다면 해당 MAC 주소로만 데이터가 전송


### 3계층 : 네트워크 계층 (Network Layer)
> 네트워크 간의 통신을 가능하게 하는 것

- 장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층 
	- 경로 정보(IP주소 등)를 기반으로 현재의 네트워크에서 다른 네트워크로 최적의 경로를 통해 데이터를 전송하는 방식을 Routing이라고 한다. ( 경로 정보가 등록되어 있는 라우팅 테이블을 이용)
- IP, ARP, ICMP 등이 있으며 패킷을 수신해야 할 상대의 주소를 지정하여 데이터를 전달 
- 상대방이 제대로 받았는지에 대해 보장하지 않는 비연결형적인 특징 
- IP 프로토콜을 이용할 시 IP 헤더가 붙으며 이를 IP 패킷이라고 부른다. 
	- 출발지 IP 주소, 목적지 IP 주소 등이 있다 .
- IP주소는 네트워크 주소와 호스트 주소부분으로 나뉜다.
- 주요 장비로는 라우터가 있다. 
	- 서로 다른 네트워크와 통신하기 위해 필요하며 IP주소를 이해하고, IP주소를 이요하여 최적의 경로를 찾고 그 경로로 패킷을 전송한다.


### 4계층 : 전송 계층 (Transport Layer)
> 송신자와 수진자를 연결하는 통신 서비스를 제공하며 연결 지향 데이터 스트림 지원, 신뢰성, 흐름 제어를 제공하며, 세션 계층과  네트워크계층 사이의 데이터가 전달될 때의 중계 역할
- 데이터를 전송하고, 전송 속도를 조절하며, 오류가 발생한 부분은 다시 맞춰 주는 계층
- 전송 받은 데이터를 합산하여 세션 계층으로 보내주게 된다. 
- 주로 TCP, UDP 프로토콜을 사용하며, 헤더에 송신지와 수신지의 포트 번호를 포함하여 전달하는 계층 
	- TCP : 순서를 보장하고 연결 지향 프로토콜을 사용해서 연결을 하여 신뢰성을 구축해서 수신 여부를 확인하며 `가상회선 패킷 교환 방식`을 사용한다. 
		- TCP 헤더를 붙이며 이를 세그먼트라고 부른다. 
		- 가상회선 패킷 교환 방식 : 각 패킷에는 가상회선 식별자가 포함되며 모든 패킷을 전송하면 가상회선이 해제되고 패킷들은 전송된 **순서대로** 도착하는 방식
	- UDP : 순서를 보장하지 않고 수신 여부를 확인하지 않으며 단순히 데이터만 주는 `데이터그램 패킷 교환 방식`을 사용한다. 
		- UDP 헤더를 붙이며 이를 UDP 데이터그램이라고 부른다. 
		- 데이터그램 패킷 교환 방식 : 패킷이 독립적으로 이동하며 최적의 경로를 선택하여 가는데, 하나의 메시지에서 분할된 여러 패킷은 서로 다른 경로롤 전송될 수 있으며 도착한 순서가 다를 수 잇는 방식
	- 포트번호 : 하나의 컴퓨터에서 동시에 실행되고 있는 프로세스들이 서로 겹치지 않게 가져야하는 정수 값

<br> 

### 5계층 : 세션 계층 
- 네트워크상 양쪽 연결을 관리하고 연결을 지속 시켜주는 계층 
- 주로 TCP/IP 세션을 만들고 유지하며, 세션이 종료되거나 전송이 중단될 시 복구하는 기능이 있다. 
- 또한, 통신하는 사용자들을 동기화한다는 특징이 있다. 
- 통신 연결은 포트 기반으로 구성하여 연결하며, 운영 체제가 통신을 하기 위한 세션 확립, 유지, 중단 과정을 해준다. 
- 전송 단위는 메시지이다.
- 세션 
	- 일정 시간 동안 같은 사용자로부터 들어오는 일련의 요구를 하나의 상태로 보고 그 상태를 일정하게 유지하는 기술 
	- 즉, 방문자가 웹 서버에 접속해 있는 상태를 하나의 단위로 보고 이를 세션이라고 부른다. 

### 6계층 : 표현 계층 
- 코드 간의 번역을 담당하며 사용자 시스템에서 데이터의 형식 상 차이를 다루는 부담을 응용 계층으로부터 덜어 준다. 
- MIME 인코딩이나 암호화 등과 같은 동작이 이루어진다. 
- 전송 단위는 메시지이다.

### 7계층 : 응용 계층 
- 사용자 또는 어플케이션이 네트워크 접근할 수 있도록 해준다. 
- HTTP, FTP, SMTP, POP3, Telnet와 같은 프로토콜이 있다.
- 전송 단위는 메시지이다.

<br>

## 캡슐화와 역캡슐화
### 캡슐화 
> 사용자가 전송하고자 하는 데이터는 각 프로토콜의 정보를 Header에 포함시켜서 하위 계층에 전달하고(Encapsulation), 이것은 최종적으로 물리 계층에서 binary 데이터로 변환되어 전송됩니다.

![](https://i.imgur.com/7kd1FTe.png)
[출처](http://www.yes24.com/Product/Goods/108887922)

상위 계층의 헤더와 데이터를 하위 계층의 데이터 부분에 포함시키고 해당 계층의 헤더를 삽입하는 과정
- 애플레케이션 -> 전송 : `세그먼트 또는 데이터그램화`되며 TCP 헤더가 붙는다. 
- 전송 -> 인터넷 : IP 헤더가 붙으며 `패킷화`가 된다.
- 인터넷 -> 링크 : 프레임 헤더와 프레임 트레일러가 붙어 `프레임화`가 된다.


### 비캡슐화
> 상대측에서는 이러한 Header를 역순으로 하나씩 제거하면서 상위 계층으로 데이터를 전달하고(Decapsulation), 최종적으로 원본 데이터를 수신하게 됩니다.

![](https://i.imgur.com/0SQbgP8.png)

[출처](http://www.yes24.com/Product/Goods/108887922)

하위 계층에서 상위 계층으로 가며 각 계층의 헤더 부분을 제거하는 과정

<br>

## TCP/IP 4계층 
![](https://i.imgur.com/dlRTEwA.png)
[출처](https://www.youtube.com/watch?v=1pfTxp25MA8&t=185s)

인터넷 환경에서 대부분은 IP를 기반한 TCP 통신으로 이루어져 있으며 이에 TCP/IP 통신을 기준으로 만든 것이 바로 TCP/IP 4계층이다. OSI 7계층 모델은 컴퓨팅 시스템에 사용되는 이론적인 모델이지만, TCP/IP 4계층 모델은 실제 사용되고 있는 모델이다. 
OSI 계층과는 달리 애플리케이션, 표현, 세션 계층이 하나의 애플리케이션 계층으로 그려지고 네트워크 계층을 인터넷 계층이라고 부르며, 데이터 링크, 물리 계층을 네트워크 이넡페이스 계층이라고 부른다. 
하지만 이는 꾸준히 갱신되면서 다시 세분화되어 인터넷 계층을 다시 네트워크 계층이라고 부르고 네트워크 인터페이스 계층을 다시 데이터 링크와 물리 계층으로 나뉘어 TCP/IP 5계층 모델이 되었다.