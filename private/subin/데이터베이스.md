---

mindmap-plugin: basic

---

# 데이터베이스

## 정규화
- 이상현상

## 트랜잭션
- 개념
- 격리수준
   - ACID의 격리성을 보장하면서도 성능을 보장하기 위한 trade off의 정도
   - ANSI 표준은 4단계로 나눔

## ACID
- Atomicity (원자성)
   - 모두 성공하거나 혹은 모두 실패
   - All or Nothing
- Consistency (일관성)
   - 일관성 있는 데이터베이스 상태를 유지해야 한다
   - ex) 무결성 제약조건
- Isolation (격리성)
   - 동시에 실행되는 트랜잭션들이 서로에게 영향을 미치지 않도록 격리해야 한다
   - 격리성은 동시성과 관련된 성능 이슈로 인해 격리수준을 선택할 수 있다
   - 단점
      - 트랜잭션간에 격리성을 완벽히 보장하려면 동시에 처리되는 트랜잭션을 거의 차례대로 실행을 해야함
         -> 처리성능 매우 bad
      - 따라서 ANSI 표준은 트랜잭션 격리 수준을 4단계로 나누어 정의함
- Durability (지속성)
   - 트랜잭션이 끝났다면 그 결과가 기록되어야 한다

## LOCK

## 샤딩 ^7a5f6df5-551c-360c
- stateless
   - API 서버들은 대부분 Stateless
      - 로드밸런서에 추가
   - DB서버는 stateful한 서버
      - scale up
      - 읽기 분산 (Query off)
         - 8Read:2Write
- Database Partitioning
   - Vertical
      - 하나의 Table을 컬럼 기준으로 나눈다 (스키마 변경)
         - 자주 사용하는 컬럼과 자주 사용하지 않는 컬럼으로 나누어서 성능 향상
         - 정규화하는 과정도 이와 비슷하다고 볼 수 있지만 Vertical Partitioning은 이미 정규화된 Data를 분리하는 과정
   - Horizontal (샤딩)
      - 여러개의 데이터베이스에 분산시켜서 저장하는 방식
      - 여러대의 DB와 연결이 되어야 한다
      - 같은 Table을 데이터 기준으로 나눈다 (스키마 동일)
      - 1 2 3 4 -> 1 2 / 3 4
      - 이슈
         - 어떤 데이터를 어디에 저장할까?
         - 특정 키를 저장하는 방법
            (특정 키를 찾는 방법)
      - 방법
         - Range
            - 특정 범위대역으로 나누닉
               - 장점
                  - 새로운 Shard를 추가하는것이 다른것보다 쉽다
               - 단점
                  - Shard간 데이터가 균등하지 못할 가능성이 높다
         - Modular
            - 서버 대수로 나누기 (ID%N)
               - 장점
                  - 데이터의 분배가 균등한 편
               - 단점
                  - 서버 대수의 변화에 굉장히 취약하다
                  - 데이터의 이동이 심해진다
                  - 두배로 늘리면 편함
            - 해시샤딩이라고도 불림
         - Indexed
            - 특정 데이터의 위치를 가리키는 서버가 존재
               - 장점
                  - 데이터의 분배를 원하는 형태로 하기 쉽다
               - 단점
                  - Indexed 자체가 하나의 서비스가 되어야 한다 (SPOF될수있음)
                     - 완화
                        - 요청후에 User 위치정보를 저장후, 이후 요청은 해당 데이터로 한다
                           재요청시 -> 유저정보가 없는경우 / 유저 정보가 변경되어 유저정보가 없다는 응답을 받는 경우
                        - 단, 이에 대한 구현이 필요하다
         - List
            - Sub title
- VLDB (Very Large DBMS)
   - 전체 DB가 하나의 DBMS에 다 들어가기 힘들어지는 DBMS
   - 서비스의 크기가 점점 커지게 되면서 다양하고 많은 Table들이 존재하게 되었다

## Replication ^3025b7d2-4f0f-6b11
- 데이터의 복제
   - Primary의 데이터를 Secondary에 복사해서 데이터의 싱크를 맞추는 작업
   - 만약 이런 Replication이 제대로 동작하지 않는다면, 데이터 유실이 많이 발생하게 된다
- 장애시 FailOver
   - Active/StandBy 패턴
      - Active
         - Primary는 읽기/쓰기를 모두 담당한다
      - StandBy
         - Primary의 데이터를 Replication 받다가
            primary 장애시에 Primary로 승격되어 읽기/쓰기를 담당하게 된다
         - 처리되지 않은 로그들을 모두 처리 후 Primary로 승격
         - MySQL의 MHA, MMM 방식등이 있음
      - 몇대의 StandBy가 좋을까?
         - 데이터의 갭이 크면 데이터의 복제에 많은 부하가 발생한다
         - 기본적으로 2대의 Secondary를 추천하지만 비용이 더 든다
      - StandBy 서버도 Active와 같은 규모의 장비
         - 서비스의 성능을 높이기 위해서 Primary에서 Write를 하고, Secondary에서 Read를 사용할 수 있음
      - Replication Lag
         - Primary와 Secondary의 데이터가 다르므로, 이미 쓰여진 데이터를 읽지 못할 수 있다
            - 내가 쓴 SNS 댓글이 보이지 않는다
            - 내가 송금한 금액이 보이지 않는다
               - 크리티컬함
            - 서비스에서 허용할 수 있는 경우와 허용할 수 없는 경우가 존재한다
         - Primary의 데이터를 Secondary가 복제할 경우 데이터의 시간차가 발생한다
         - 데이터 복제는 Eventual Consistency를 제공한다
         - Replication Lag가 발생한 상황에서 데이터를 캐시하게 되면 문제가 오래 지속될 수 있음

## FailOver ^010240ae-8a90-0983
- 서비스 가용성을 제공하기 위해 사용

## RDBMS
- 관계형 데이터베이스
   - 관계형 데이터베이스란?
      - 키(key)와 값(value)들의 간단한 관계를 테이블화 시킨 데이터베이스
   - ACID 속성
   - 종류
      - DML
      - DDL
      - DCL
   - Key
      - PK
         - 고유 키(Primary key)가 각 로우를 식별한다
      - FK
         - 한 테이블 안의 로우는 다른 테이블들의 로우로 연결이 가능한데,
            
            이는 연결된 로우의 고유 키를 위한 컬럼을 추가함으로써 이루어진다
   - 특징
      - 데이터 테이블, 뷰 및 인덱스와 같은 논리 데이터 구조가 물리적인 스토리지 구조와 분리되어 있다
         - 논리적 구조로서 해당 데이터에 대한 액세스에 영향을 주지 않고 물리적 데이터 저장소를 관리할 수 있다
         - 예를 들어, 데이터베이스 파일의 이름을 변경해도 그 안에 저장된 테이블의 이름은 변경되지 않는다
         - 논리에서는 entity 물리에서는 table이라고 주로 부른다
      - 신뢰성이 높고, 어떤 상황에서도 데이터의 무결성 보장
      - 데이터 베이스 부하를 분석하는것이 어렵다?
   - 관계
      - 1:1
      - 1:N
      - N:M
         - N:M(다대다) 관계를 위해 스키마를 디자인할 때에는, Join 테이블을 만들어 관리한다.
         - 관계형 데이터베이스는 정규화된 테이블 2개라 다대다 관계를 표현할 수 없기 때문
      - self referencing
   - 트랜잭션
      - DBMS가 효율적이고 정확하게 운용되기 위해서는 ACID 트랜잭션을 갖추고 있어야 한다
   - 제약
      - 개체 무결성
         - 릴레이션에서 기본키를 구성하는 속성은 널(Null)값이나 중복값을 가질 수 없다
      - 참조 무결성
         - 외래키 값은 NULL이거나 참조 릴레이션의 기본키 값과 동일해야함
      - 도메인 제약
         - 속성의 범위에 추가적으로 제한을 둘 수 있다
         - 인덱스라던가 범위라던가
   - 정규화
      - 설계에서 중복을 최소화하게 데이터를 구조화하는 프로세스
- Join
   - 두 개 이상의 테이블이나 데이터베이스를 연결하여 데이터를 검색하는 방법
   - 여러개의 테이블을 마치 하나의 테이블인 것처럼 활용하는 방법
   - 종류
      - 데이터베이스 종류에 따라서 문법은 다르지만 비슷함